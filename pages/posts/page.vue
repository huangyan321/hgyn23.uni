<template>
	<view class="page-posts">
		<scroll-view class="listview" style="flex: 1;" enableBackToTop="true" scroll-y @scrolltolower="loadMore()">
			<view v-for="(item , index) in dataList" :key="item.id">
				<PostPageItem :post-item="item" @click="goDetail(item)">
				</PostPageItem>
			</view>
			<LoadMore :status="loadMoreStatus"></LoadMore>
			<!-- <view class="loading-more" v-if="isLoading || dataList.length > 4">
				<text class="loading-more-text">{{loadingText}}</text>
			</view> -->
		</scroll-view>
		<NoData class="no-data" v-if="isNoData" @retry="loadMore"></NoData>
	</view>
</template>

<script setup lang="ts">
	import { reactive, ref, } from 'vue'
	import NoData from '@/components/NoData/NoData.nvue'
	import PostPageItem from './page-item.vue'
	interface IProps {
		tabId : number
	}
	const props = defineProps<IProps>()
	// Êï∞ÊçÆÂ§ÑÁêÜ
	const isNoData = ref(false)
	const dataList = ref([])
	const requestParams = reactive({
		id: 0
	})
	const loadMoreStatus = ref<'more' | 'loading' | 'noMore'>('more')
	function loadData() {
		return new Promise((resolve) => {
			console.log('loadData');
			isLoading.value = true
			uni.showToast({
				icon: 'loading',
				title: 'ËØ∑Á®çÂêé...',
				mask: true
			})
			setTimeout(() => {

				const list = [
					{
						"created_at": "2024-03-27 22:29:07",
						"updated_at": "2024-04-15 23:02:18",
						"id": 276,
						"title": "Work in Progress",
						"description": "üëÄÔ∏è",
						"img_cover": "",
						"seo_keyword": "Â≠¶‰π†",
						"is_top": 1,
						"status": 1,
						"sort": 1,
						"ai_summary": "",
						"browse": 38,
						"like_count": 0,
						"uid": 1,
						"category_id": 7,
						"reading_time": 42000,
						"x_tags": [
							{
								"id": 13,
								"name": "Ë∑ØÁ∫ø"
							}
						],
						"category_info": {
							"id": 7,
							"name": "È°πÁõÆ"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					},
					{
						"created_at": "2024-02-20 22:45:24",
						"updated_at": "2024-03-03 22:22:24",
						"id": 274,
						"title": "ÂºÄÂèëËÆ°Âàí",
						"description": "Âàó‰∏æ‰∏Ä‰∫õ‰ºòÂåñÁÇπÂèä‰ªäÂêéÂºÄÂèëËÆ°Âàí",
						"img_cover": "",
						"seo_keyword": "ÂºÄÂèëËÆ°Âàí",
						"is_top": 1,
						"status": 1,
						"sort": 1,
						"ai_summary": "",
						"browse": 86,
						"like_count": 0,
						"uid": 1,
						"category_id": 1,
						"reading_time": 88500,
						"x_tags": [
							{
								"id": 13,
								"name": "Ë∑ØÁ∫ø"
							}
						],
						"category_info": {
							"id": 1,
							"name": "ÂâçÁ´Ø"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					},
					{
						"created_at": "2024-04-15 22:44:38",
						"updated_at": "2024-04-15 22:46:33",
						"id": 277,
						"title": "ÈÄöÁî®‰Ωé‰ª£Á†ÅÂπ≥Âè∞Â§ÑÁêÜÂ∞ëÊï∞ÁâπÊÆäÈúÄÊ±ÇÁöÑÊñπÊ°àÂàó‰∏æ",
						"description": "ÈÄöËøáÊãñÊãâÊãΩÊñπÂºèÁîüÊàêÈÖçÁΩÆÂåñ JSON ÁöÑËÆæËÆ°Ê®°ÂºèÈùûÂ∏∏ÈÄÇÁî®‰∫éÂø´ÈÄüÂºÄÂèëÂíåÈÉ®ÁΩ≤Ê†áÂáÜÂåñÁöÑÂâçÁ´ØÂ∫îÁî®„ÄÇÈíàÂØπÈÇ£‰∫õÊó†Ê≥ïÂÆåÂÖ®Áî±ÈÖçÁΩÆÂåñÂπ≥Âè∞Ë¶ÜÁõñÁöÑÁâπÊÆäÈúÄÊ±ÇÔºàÂ§ßÁ∫¶10%ÔºâÔºåËøôÈáåÊúâ‰∏Ä‰∫õÂèØ‰ª•Â∏ÆÂä©ÂºÄÂèëËÄÖÁÅµÊ¥ªÂ§ÑÁêÜËøô‰∫õÊÉÖÂÜµÁöÑÂÆûË∑µÊñπÊ≥ï",
						"img_cover": "",
						"seo_keyword": "‰Ωé‰ª£Á†Å",
						"is_top": 0,
						"status": 1,
						"sort": 1,
						"ai_summary": "",
						"browse": 12,
						"like_count": 0,
						"uid": 1,
						"category_id": 1,
						"reading_time": 218400,
						"x_tags": [
							{
								"id": 16,
								"name": "‰Ωé‰ª£Á†Å"
							}
						],
						"category_info": {
							"id": 1,
							"name": "ÂâçÁ´Ø"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					},
					{
						"created_at": "2023-12-06 09:42:22",
						"updated_at": "2024-02-29 21:12:37",
						"id": 270,
						"title": "Vue2/3 ÈÄöÁî®Êåá‰ª§ÂåñÂºπÁ™óÁªÑ‰ª∂Â∞ÅË£Ö",
						"description": "Êåá‰ª§ÂåñÂºπÁ™óÔºåÈ°æÂêçÊÄù‰πâÊòØÈÄöËøá‰ª£Á†ÅË∞ÉÁî®ÊñπÂºèÂî§Ëµ∑ÁöÑÂºπÁ™óÔºåÂú®Êüê‰∫õÂú∫ÊôØ‰∏ãÂÖ∑ÊúâÈùûÂ∏∏È´òÁöÑÁÅµÊ¥ªÊÄß„ÄÇ",
						"img_cover": "https://docsapi.hgyn23.cn/Vue.js_Logo_2.svg.png",
						"seo_keyword": "vueÁªÑ‰ª∂",
						"is_top": 0,
						"status": 1,
						"sort": 1,
						"ai_summary": "ËøôÊÆµ‰ª£Á†ÅÊòØ‰∏Ä‰∏™VueÁªÑ‰ª∂ÔºåÁî®‰∫éÂàõÂª∫‰∏Ä‰∏™Ê®°ÊÄÅÊ°ÜÔºàModalÔºâ„ÄÇÊ®°ÊÄÅÊ°ÜÊúâÈªòËÆ§ÁöÑÊ†áÈ¢ò„ÄÅÂÜÖÂÆπÂíåÂ∫ïÈÉ®Ôºå‰ª•Âèä‰∏Ä‰∏™Á°ÆÂÆöÊåâÈíÆ„ÄÇÊ†∑ÂºèÂÆö‰πâ‰∫ÜÊåâÈíÆ„ÄÅÂç°ÁâáÂíåÊ®°ÊÄÅÊ°ÜÁöÑÂ§ñËßÇ„ÄÇ‰ª£Á†ÅËøòÂåÖÂê´‰∫ÜVue2ÂíåVue3ÁâàÊú¨ÁöÑÁªÑ‰ª∂ÂÆûÁé∞„ÄÇ",
						"browse": 366,
						"like_count": 0,
						"uid": 1,
						"category_id": 1,
						"reading_time": 288000,
						"x_tags": [
							{
								"id": 6,
								"name": "Vue"
							}
						],
						"category_info": {
							"id": 1,
							"name": "ÂâçÁ´Ø"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					},
					{
						"created_at": "2023-11-18 01:18:59",
						"updated_at": "2024-02-19 10:11:02",
						"id": 269,
						"title": "Ê®°ÊùøDSLÁºñËØëÂô®Ê†∏ÂøÉÂÆûÁé∞ÊÄùË∑Ø",
						"description": "üëÄÔ∏è ÁºñËØëÂô®ÂÖ∂ÂÆûÂè™ÊòØ‰∏ÄÊÆµÁ®ãÂ∫èÔºåÂÆÉÁî®Êù•Â∞Ü‰∏ÄÁßçËØ≠Ë®ÄAÁøªËØëÊàêÂè¶‰∏ÄÁßçËØ≠Ë®ÄB„ÄÇÂÖ∂‰∏≠ËØ≠Ë®ÄAÂè´ÂÅö**Ê∫êËØ≠Ë®Ä**ÔºåËØ≠Ë®ÄBÂè´ÂÅö**ÁõÆÊ†áËØ≠Ë®Ä**„ÄÇÁºñËØëÂô®Â∞ÜÊ∫êËØ≠Ë®ÄÁøªËØë‰∏∫ÁõÆÊ†áËØ≠Ë®ÄÁöÑËøáÁ®ãË¢´Áß∞‰∏∫**ÁºñËØë**„ÄÇ",
						"img_cover": "",
						"seo_keyword": "ÁºñËØëÂô®",
						"is_top": 0,
						"status": 1,
						"sort": 1,
						"ai_summary": "Êú¨Êñá‰ªãÁªç‰∫ÜVueÊ®°ÊùøÁºñËØëÁöÑÂ∑•‰ΩúÊµÅÁ®ãÂíåÂÆûÁé∞ÊÄùË∑Ø„ÄÇÁºñËØëÂô®ÊòØÂ∞Ü‰∏ÄÁßçËØ≠Ë®ÄÁøªËØëÊàêÂè¶‰∏ÄÁßçËØ≠Ë®ÄÁöÑÁ®ãÂ∫èÔºåËÄåDSLÊòØÈíàÂØπÁâπÂÆöÈ¢ÜÂüüÁöÑËØ≠Ë®Ä„ÄÇVueÊ®°ÊùøÁºñËØëÂ∞ÜÊ®°ÊùøËØ≠Ë®ÄÁøªËØëÊàêÊ∏≤ÊüìÂáΩÊï∞ÔºåÂåÖÊã¨ËØçÊ≥ïÂàÜÊûêÂíåËØ≠Ê≥ïÂàÜÊûêÔºåÂ∞ÜÊ®°ÊùøASTËΩ¨Êç¢‰∏∫Javascript ASTÔºåÊúÄÂêéÁîüÊàêÊ∏≤ÊüìÂáΩÊï∞ÁöÑJavascript‰ª£Á†Å„ÄÇËØçÊ≥ïÂàÜÊûêÂíåËØ≠Ê≥ïÂàÜÊûêÈÄöËøáËß£ÊûêÂô®ÂÆåÊàêÔºåËß£ÊûêÂô®Ê†πÊçÆÊúâÈôêËá™Âä®Áä∂ÊÄÅÊú∫Â∞ÜÊ®°ÊùøÂàáÂâ≤‰∏∫ËØçÊ≥ïËÆ∞Âè∑„ÄÇÊúÄÂêéÁªôÂá∫‰∫ÜÂÖ∑‰ΩìÁöÑ‰ª£Á†ÅÂÆûÁé∞Á§∫‰æã„ÄÇ",
						"browse": 247,
						"like_count": 0,
						"uid": 1,
						"category_id": 1,
						"reading_time": 1535700,
						"x_tags": [
							{
								"id": 14,
								"name": "ÁºñËØëÂô®"
							}
						],
						"category_info": {
							"id": 1,
							"name": "ÂâçÁ´Ø"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					},
					{
						"created_at": "2023-11-09 10:42:20",
						"updated_at": "2024-02-18 02:05:27",
						"id": 268,
						"title": "ÂèåÁ´ØdiffÁÆóÊ≥ïËØ¶Ëß£",
						"description": "`diff` ÁÆóÊ≥ïÊòØ‰∏ÄÁßçÈÄöËøáÂêåÂ±ÇÁöÑÊ†ëËäÇÁÇπËøõË°åÊØîËæÉÁöÑÁÆóÊ≥ïÔºåÂÖ∂Âú®ÂâçÁ´ØÊ°ÜÊû∂È¢ÜÂüü‰∏≠ÂæóÂà∞ÂπøÊ≥õËøêÁî®Ôºå‰∏ªË¶ÅÁî®‰∫éËôöÊãü `dom` Ê∏≤ÊüìÊàêÁúüÂÆû `dom` ÁöÑÊñ∞Êóß `VNode` ËäÇÁÇπÊØîËæÉÔºå‰ªéËÄå‰Ωø `Dom`ËäÇÁÇπÈ´òÊïàÂú∞Êõ¥Êñ∞„ÄÇ",
						"img_cover": "https://docsapi.hgyn23.cn/‰∏ãËΩΩ.png",
						"seo_keyword": "diffÁÆóÊ≥ï",
						"is_top": 0,
						"status": 1,
						"sort": 1,
						"ai_summary": "ÂèåÁ´ØdiffÁÆóÊ≥ïÊòØVueÊ∏≤ÊüìÂô®ÁöÑÊ†∏ÂøÉÁÆóÊ≥ïÔºåÁî®‰∫éÊØîËæÉÊñ∞ÊóßËäÇÁÇπÂπ∂ÊâæÂá∫ÊúÄÂ∞èÁöÑÊõ¥Êñ∞‰ª£‰ª∑„ÄÇÁÆóÊ≥ïÈÄöËøáÂõõ‰∏™Á¥¢ÂºïÂÄºÊù•Ê†áËÆ∞Êñ∞ÊóßÂ≠êËäÇÁÇπÁöÑ‰∏§‰∏™Á´ØÁÇπÔºåÁÑ∂ÂêéËøõË°åÂèåÁ´ØÊØîËæÉ„ÄÇÊØîËæÉËøáÁ®ã‰∏≠ÔºåÂ¶ÇÊûúÊâæÂà∞ÂèØ‰ª•Â§çÁî®ÁöÑËäÇÁÇπÔºåÂàôÂ∞ÜÂÖ∂ÁßªÂä®Âà∞Ê≠£Á°ÆÁöÑ‰ΩçÁΩÆ„ÄÇÁßªÂä®ÂÆåÊàêÂêéÔºåÊõ¥Êñ∞Á¥¢ÂºïÂÄºÔºåÁªßÁª≠‰∏ã‰∏ÄËΩÆÊØîËæÉ„ÄÇÁÆóÊ≥ïÈÄöËøáÂæ™ÁéØÊù•ÂÆûÁé∞Â§öËΩÆÊØîËæÉÔºåÁõ¥Âà∞ÊâÄÊúâËäÇÁÇπÈÉΩË¢´ÊØîËæÉÂÆå„ÄÇ",
						"browse": 169,
						"like_count": 0,
						"uid": 1,
						"category_id": 1,
						"reading_time": 1670100,
						"x_tags": [
							{
								"id": 11,
								"name": "ÁÆóÊ≥ï"
							}
						],
						"category_info": {
							"id": 1,
							"name": "ÂâçÁ´Ø"
						},
						"creator_info": {
							"id": 1,
							"email": "1604549268@qq.com",
							"nickname": "huangyan321"
						}
					}
				]
				resolve(dataList.value = list)
				isLoading.value = false
				uni.hideToast()
			}, 500)

		})
	}

	function clearData() {
		dataList.value.length = 0;
		requestParams.id = 0;
	}
	// Â§ÑÁêÜÈ°µÈù¢Ë∑≥ËΩ¨

	function goDetail(detail : any) {
		console.log(detail);
		uni.navigateTo({
			url: './detail/index?query=' + encodeURIComponent(JSON.stringify(detail))
		});

	}
	// Â§ÑÁêÜ‰∏äÊãâÂä†ËΩΩ
	const loadingText = ref('Âä†ËΩΩ‰∏≠...')
	function loadMore() {
		loadMoreStatus.value = 'loading'
		setTimeout(() => {
			loadMoreStatus.value = 'more'
			dataList.value.push({
				"created_at": "2024-02-20 22:45:24",
				"updated_at": "2024-03-03 22:22:24",
				"id": 274,
				"title": "ÂºÄÂèëËÆ°Âàí",
				"description": "Âàó‰∏æ‰∏Ä‰∫õ‰ºòÂåñÁÇπÂèä‰ªäÂêéÂºÄÂèëËÆ°Âàí",
				"img_cover": "",
				"seo_keyword": "ÂºÄÂèëËÆ°Âàí",
				"is_top": 1,
				"status": 1,
				"sort": 1,
				"ai_summary": "",
				"browse": 86,
				"like_count": 0,
				"uid": 1,
				"category_id": 1,
				"reading_time": 88500,
				"x_tags": [
					{
						"id": 13,
						"name": "Ë∑ØÁ∫ø"
					}
				],
				"category_info": {
					"id": 1,
					"name": "ÂâçÁ´Ø"
				},
				"creator_info": {
					"id": 1,
					"email": "1604549268@qq.com",
					"nickname": "huangyan321"
				}
			},)
		}, 500)

	}
	// Â§ÑÁêÜ‰∏ãÊãâÂà∑Êñ∞
	const refreshIcon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAB5QTFRFcHBw3Nzct7e39vb2ycnJioqK7e3tpqam29vb////D8oK7wAAAAp0Uk5T////////////ALLMLM8AAABxSURBVHja7JVBDoAgDASrjqj//7CJBi90iyYeOHTPMwmFZrHjYyyFYYUy1bwUZqtJIYVxhf1a6u0R7iUvWsCcrEtwJHp8MwMdvh2amHduiZD3rpWId9+BgPd7Cc2LIkPyqvlQvKxKBJ//Qwq/CacAAwDUv0a0YuKhzgAAAABJRU5ErkJggg=="
	const isLoading = ref(true)
	// function refreshData() {
	// 	if (isLoading) {
	// 		return;
	// 	}
	// 	this.pulling = true;
	// 	this.refreshing = true;
	// 	this.refreshText = "Ê≠£Âú®Âà∑Êñ∞...";
	// 	this.loadData(true);
	// },

	defineExpose({ loadData, dataList, clear: clearData })
</script>

<style scoped lang="scss">
	.no-data {
		flex: 1;
		position: absolute;
		left: 0;
		top: 0;
		right: 0;
		bottom: 0;
		z-index: 10;
	}

	.page-posts {
		flex: 1;
		display: flex;
		flex-direction: column;
		position: absolute;
		left: 0;
		top: 0;
		right: 0;
		bottom: 0;
	}

	.listview {
		position: absolute;
		left: 0;
		top: 0;
		right: 0;
		bottom: 0;
		/* #ifndef APP-NVUE */
		display: flex;
		flex-direction: column;
		/* #endif */
		/* #ifndef MP-ALIPAY */
		flex-direction: column;
		/* #endif */
	}

	.refresh {
		justify-content: center;
	}

	.refresh-view {
		/* #ifndef APP-NVUE */
		display: flex;
		/* #endif */
		width: 750rpx;
		height: 64px;
		flex-direction: row;
		flex-wrap: nowrap;
		align-items: center;
		justify-content: center;
	}

	.refresh-icon {
		width: 32px;
		height: 32px;
		transition-duration: .5s;
		transition-property: transform;
		transform: rotate(0deg);
		transform-origin: 15px 15px;
	}

	.refresh-icon-active {
		transform: rotate(180deg);
	}

	.loading-icon {
		width: 28px;
		height: 28px;
		margin-right: 5px;
		color: gray;
	}

	.loading-text {
		margin-left: 2px;
		font-size: 16px;
		color: #999999;
	}

	.loading-more {
		align-items: center;
		justify-content: center;
		padding-top: 14px;
		padding-bottom: 14px;
		text-align: center;
	}

	.loading-more-text {
		font-size: 28upx;
		color: #999;
	}
</style>